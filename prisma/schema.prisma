generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model User {
  id                                  Int                     @id @default(autoincrement())
  nom                                 String                  @db.VarChar(100)
  prenom                              String?                 @db.VarChar(100)
  adresse                             String?                 @db.VarChar(100)
  email                               String                  @unique @db.VarChar(150)
  mot_de_passe                        String
  telephone                           String?                 @unique @db.VarChar(10)
  role                                String                  @default("citoyen") @db.VarChar(20)
  date_inscription                    DateTime?               @default(now()) @db.Timestamp(6)
  cin                                 String?                 @unique @db.VarChar(12)
  demandes_demandes_citoyen_idTousers demandes[]              @relation("demandes_citoyen_idTousers")
  notifications                       notifications[]
  password_reset_tokens               password_reset_tokens[]
  traitements                         traitements[]

  @@map("users")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model demandes {
  id               Int             @id @default(autoincrement())
  citoyen_id       Int?
  type_id          Int?
  description      String?
  statut           String?         @default("soumise") @db.VarChar(30)
  date_soumission  DateTime?       @default(now()) @db.Timestamp(6)
  date_mise_a_jour DateTime?       @default(now()) @db.Timestamp(6)
  qr_code          String?
  remarque         String?
  reference        String?         @unique @db.VarChar(10)
  user             User?           @relation("demandes_citoyen_idTousers", fields: [citoyen_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  types_demande    types_demandes? @relation(fields: [type_id], references: [id], onDelete: NoAction)
  fichiers         fichiers[]
  notifications    notifications[]
  traitements      traitements[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model fichiers {
  id             Int       @id @default(autoincrement())
  demande_id     Int?
  nom_fichier    String?
  chemin_fichier String?
  type_fichier   String?   @db.VarChar(50)
  role_fichier   String?   @default("justificatif") @db.VarChar(30)
  date_upload    DateTime? @default(now()) @db.Timestamp(6)
  demandes       demandes? @relation(fields: [demande_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model traitements {
  id          Int       @id @default(autoincrement())
  demande_id  Int?
  agent_id    Int?
  action      String?   @db.VarChar(100)
  commentaire String?
  date_action DateTime? @default(now()) @db.Timestamp(6)
  users       User?     @relation(fields: [agent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  demandes    demandes? @relation(fields: [demande_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model types_demandes {
  id              Int        @id @default(autoincrement())
  nom             String     @db.VarChar(100)
  description     String?
  delai_estime    Int?
  pieces_requises String[]
  demandes        demandes[]
}

model notifications {
  id         Int       @id @default(autoincrement())
  titre      String    @db.VarChar(50)
  message    String
  statut     String?   @default("non_lu") @db.VarChar(20)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  demande_id Int
  citoyen_id Int
  users      User      @relation(fields: [citoyen_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_citoyen")
  demandes   demandes  @relation(fields: [demande_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_demande")
}

model password_reset_tokens {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  token      String    @unique @db.VarChar(100)
  expires_at DateTime? @db.Timestamp(6)
  is_used    Boolean?  @default(false)
  users      User?     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_reset_password_user")
}
